{% extends "release.html" %}
{% from "macros.html" import artist_link, user_link, tag_list %}
{% from "release_list.html" import rating_widget %}

{% set current_tab = "main" %}

{% set client_json_data = {
    "releaseId": release.id,
    "releaseActions": user_actions and user_actions.action_names(),
    "trackInfo": track_info,
    "picks": picks | list,
    "comparisonPicks": comparison_picks | list,
    "comparisonUser": comparison_user and comparison_user.username
} %}

{% block content_below_tabs %}
<section class="album page content">
    <div class="album-main">
        <header>
            {% if comparison_user %}
                <h3 style="font-style: italic; margin-bottom: 0.2em;">
                    Comparing with {{ user_link(comparison_user) }}</h3>
            {% endif %}
            <h1 class="album-title">
                {% set average_rating = release.average_rating() %}
                {# Comes before but floated right, so that it doesn't get selected #}
                <span class="unselectable" id="average-rating-section"
                      style="{{ '' if average_rating else 'display: none;' }}">
                    <span id="average-rating">
                        {{ "%.1f" % average_rating if average_rating else '' }}</span>
                </span>
                {{ release.title }}
            </h1>
            <h2 class="byline">
                {% for artist in release.artists.all() %}
                    {# The unusual arrangement here ensures there's no whitespace 
                       between the last artist and the comma. #}
                    <span class="author">{{ artist_link(artist) 
                    }}</span>{% endfor %}{% if release.release_year_str %},
                    <time>{{ release.release_year_str }}</time>
                {% endif %}
            </h2>
            <div>
            {{ tag_list(release.tags.all()) }}
            </div>
        </header>
        
        {# Rendered by react with client_json_data #}
        <div class="track-list"></div>
                    
        {% if not request.user.is_anonymous %}
            {# Also rendered by react #}
            <div class="release-actions"></div>

            {{ rating_widget(release, user_actions.rating() if user_actions else None, None) }}
        {% endif %}
    </div>
    <div class="album-side clearfix">
        {% if release.art_url_max %}
            <a href="{{ release.art_url_max }}">
                <img class="cover-art" src="{{ release.art_url_500 }}"/></a><br/>
        {% endif %}
        {% for website, external_link in release.external_links.from_sites([
               "AZLyrics", "Allmusic", "Bandcamp", "MusicBrainz",
               "SoundCloud", "UltimateGuitar", "Wikipedia"
           ]) %}
            {% if loop.index == 1 %}<br/>{% endif %}
            <a href={{ external_link.url }}>{{ website }}</a>
        {% endfor %}
    </div>
</section>
{% endblock %}
