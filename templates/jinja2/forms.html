{% macro form_field(description, name, type, form_prefill=None, prefill=None) -%}
    <dt>{{ description }}</dt>
    <dd>
        <input type={{ type }} name={{ name }}
               value="{{ prefill if prefill else form_prefill[name] if form_prefill and name in form_prefill else ''}}" />
    </dd>
{%- endmacro %}

{% macro django_form_fields(form) -%}
    {% for field in form %}
        <dt>{{ field.label_tag() }}</dt>
        <dd>
            {{ field }}
            {{ field.errors }}
        </dd>
    {% endfor %}
{%- endmacro %}

{% macro set_pw_form(user, standalone=False) -%}
    <form action={{ url_for("set_password") }} method="post" class="clearfix">
        <dl>
            {{ form_field("Current password", "password", "password")}}
            {{ form_field("New password", "new-password", "password")}}
            {{ form_field("Confirm new password", "verify-new-password", "password")}}
            
            <dd><input type="submit" value="Change" /></dd>
            
            {% if standalone %}
                <input type="hidden" name="next" value="{{ request.referrer }}" />
            {% endif %}
        </dl>
    </form>
{%- endmacro %}

{% macro settings_form(user) -%}
    <form action={{ url_for("user_settings") }} method="post" class="clearfix">
        <dl>
            {{ form_field("Email address", "email", "text", prefill=user.email if user.email else "") }}
            {{ form_field("Timezone", "timezone", "text", prefill=user.timezone) }}
            {{ form_field("Avatar URL", "avatar_url", "text", prefill=user.avatar_url) }}
            <p>Image must be within size constraints and on an approved host</p>
            <dt>Listening to a release unlists it</dt>
            <dd><input type="checkbox" name="listen_implies_unlist" {% if user.get_listen_implies_unlist() %}checked{% endif %}></dd>
            
            <dd><input type="submit" value="Save changes" /></dd>
        </dl>
    </form>
{%- endmacro %}

{% macro small_search_form(previous_search=None) -%}
    <form action="/search" method="get" class="small" id="search">
        <div class="search">
            <input type="text" name="q" placeholder="Search r8music" id="autocomplete" class="form-control input-lg"
                   {% if previous_search and previous_search.query %} value="{{ previous_search.query }}" {% endif %} />
            <input type="submit" class="material-icons" value="search" />
        </div>
    </form>
{% endmacro %}

{% macro search_form(previous_query=None, full_size=False) -%}
    <form action="/search" method="get" class="{{ '' if full_size else 'small' }}" id="search">
        <dl>
            <dd class="search">
                <input type="text" name="q" placeholder="Search r8music" id="autocomplete" class="form-control input-lg"
                       {% if previous_query %} value="{{ previous_query }}" {% endif %} />
                <input type="submit" class="material-icons" value="search" />
            </dd>
        </dl>
    </form>
{%- endmacro %}
