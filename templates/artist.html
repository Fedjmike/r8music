{% extends "layout.html" %}
{% from "macros.html" import artist_link, page_tabs, subpage_header, artist_details, tag_list %}
{% from "release_list.html" import release_list, release_grid %}
{% from "activity_list.html" import activity_list %}

{% block title %}{{ artist.name }} {{ super() }}{% endblock %}

{% block content %}

{{ page_tabs([(None, artist.name),
              ("activity", "Activity")],
             artist.url, current_tab=tab) }}

{% if tab == "activity" %}
    <section class="content page">
        {{ subpage_header("Activity", artist_link(artist)) }}
        {% set last_action, actions = artist.get_activity_on_releases() %}
        {{ activity_list(actions) }}
    </section>

{% else %}
    <section class="page columns content">
        <div>
            <header><h1>{{ artist.name }}</h1></header>
            {{ artist_details(artist) }}
        </div>
        <div class="column-1-3">
            {% set thumb, image = artist.get_image() %}
            {% if image %}
                <a class="artist-image-container" href={{ image }}><img class="artist-image" src={{ thumb }}></a>
            {% else %}
                <header></header>
            {% endif %}
            
            {% set common_tags = artist.get_common_tags(limit=5) %}
            {% set top_tracks = artist.get_top_tracks(limit=3) %}
            <table>
                {% if common_tags %}
                <tr>
                    <td>Genres</td><td>{{ tag_list(common_tags) }}</td>
                </tr>
                {% endif %}
                {% if top_tracks %}
                <tr>
                    <td>Picks</td>
                    <td>
                        <ol>
                        {% for count, track, release in top_tracks %}
                            <li class="comma-separated"><a href={{ release.url }}>{{ track.title }}</a></li>
                        {% endfor %}
                        </ol>
                    </td>
                </tr>
                {% endif %}
            </table>
        </div>
    </section>
    {% set albums = artist.get_releases() | selectattr("release_type", "equalto", "Album") | list %}
    {% if albums %}
    <section class="content page">
        <header>
            <span class="right de-emph" style="clear: right">Out of date? <a href={{ url_for("update_artist", id=artist.id) }}>Update this artist</a></span>
            <h2>Albums</h2>
        </header>
        {{ release_grid(albums | sort(attribute="date"), user, show_date_not_artist=True, show_average_rating=True) }}
    </section>
    {% endif %}
    <section class="content page">
        {% set others = artist.get_releases() | rejectattr("release_type", "equalto", "Album") | list %}
        {% if others %}
            <header><h3>Other releases</h3></header>
            {{ release_grid(others | sort(attribute="date"), user, "small", show_date_not_artist=True, show_average_rating=True) }}
        {% endif %}
    </section>
{% endif %}
{% endblock %}